# PLURTECH API

## Model
Generated by Rails ERD. Run `rake erd` to regenerate (must have graphvis).
![](/erd.png)

TODO:

Users
- Authentication
- Social media account validations

Messages
- from_user_id
- to_user_id
- message
- timestamp
- location
- images,etc

Friends

Last viewed message
 

$ rails new plurtech_api --api -T
$ rails g scaffold user name email username phone

TODO:

Some setup you must do manually if you haven't yet:

1. Ensure you have defined default url options in your environments files. Here
 is an example of default_url_options appropriate for a development environment
 in config/environments/development.rb:

   config.action_mailer.default_url_options = { host: 'localhost', port: 3000 }

 In production, :host should be set to the actual host of your application.

2. Ensure you have defined root_url to *something* in your config/routes.rb.
 For example:

   root to: "home#index"

3. Ensure you have flash messages in app/views/layouts/application.html.erb.
 For example:

   <p class="notice"><%= notice %></p>
   <p class="alert"><%= alert %></p>

4. You can copy Devise views (for customization) to your app by running:

   rails g devise:views


## Configuration and System dependencies
- Ubuntu 16.04 LTS
- ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux]
- Rails 5.2.0
- Graphviz (only for Development Environment)

## Database creation
```
$ rails db:migrate
$ rails db:seed
```

* Database initialization

* How to run the test suite

* Services (job queues, cache servers, search engines, etc.)

## API

###Users
- View all Users
~~~~
GET /users
~~~~

- View Individual User
~~~~
GET /users/1
GET /users/2
GET /users/5
RESPONSE ON SUCCESS:
{
"id": 5,
"name": "Arlette Dickinson",
"email": "dickinson.arlette@hotmail.com",
"username": "dickinson.arlette",
"profile_picture": null,
"phone": "545-259-2169",
"facebook": "https://www.facebook.com/XXX/",
"snapchat": "",
"twitter": "https://twitter.com/XXXX",
"instagram": "https://www.instagram.com/XXXX/",
"last_online": "2018-07-27T17:22:03.600Z",
"created_at": "2018-07-29T22:12:06.620Z",
"updated_at": "2018-07-29T22:12:06.620Z"
}

RESPONSE ON FAILURE: 404 Not Found
~~~~

- Create User
Constraints:
1) username is unique
2) name is between 4 and 70 characters
3) email must be of valid format
~~~


POST /users
curl -i \
-H "Accept: application/json" \
-H "Content-type: application/json" \
-X POST \
-d '{"name":"Dipen Chauhan", "email":"get.dipen@gmail.com", "username":"dipen.chauhan"}' \
http://localhost:3000/users

RESPONSE ON SUCCESS:
201 Created

RESPONSE ON FAILURE:
If the same request is sent again, we get an error because the email and username are already taken:

422 Unprocessable Entity
{
"email": ["has already been taken"],
"username": ["has already been taken"],
}
~~~

- Update User
~~~
Update any attribute(s). Never attempt to update id, created_at and updated_at attributes:
PATCH /users/5
{"name":"Dipen Chauhan","email":"get.dipen@gmail.com","username":"dc555"}

Head: 200 OK

{
"id": 5,
"name": "Dipen Chauhan",
"email": "get.dipen@gmail.com",
"username": "dc555",
"profile_picture": "https://robohash.org/perspiciatisdoloremenim.png?size=300x300&set=set1",
"phone": "1-223-768-6488",
"facebook": "https://www.facebook.com/frank.reynolds/",
"snapchat": "",
"twitter": "https://twitter.com/frank.reynolds",
"instagram": "https://www.instagram.com/frank.reynolds/",
"last_online": "2018-07-29T03:25:46.112Z",
"created_at": "2018-07-31T00:52:08.792Z",
"updated_at": "2018-07-31T02:21:31.074Z"
}
~~~

- Delete User
~~~
DELETE /users/1

RESPONSE ON SUCCESS: 204 No Content
RESPONSE ON FAILURE: 404 Not Found
~~~

- View User's Friends
~~~~
GET /users/1/friends
GET /users/2/friends
~~~~

- Delete Friend
~~~
The following will delete user3 from user1's friend list. user3 is user having id 3 and user1 is user having id 1.

DELETE /users/1/friends/3

SUCCESS: 204 No Content
FAILURE: 404 Not Found
~~~

- View User's Incoming and Outgoing Friend Requests
~~~~
GET /users/1/friend_requests
GET /users/2/friend_requests
~~~~

- View User's Incoming Friend Requests
~~~~
GET /users/1/friend_requests/incoming
~~~~

- View User's Outgoing Friend Requests
~~~~
GET /users/1/friend_requests/outgoing
~~~~

- Create User
- Update User
- Destroy User

- Create Friend Request
- Accept Friend Request
- Destroy Freind Request

- Destroy Friend

## Easy Development
- Shortcuts to SSH clients - https://askubuntu.com/questions/754450/shortcuts-to-ssh-clients

## Deployment instructions
- Setup Ruby On Rails on Ubuntu 16.04 - https://gorails.com/setup/ubuntu/16.04
- Installing Passenger + Nginx on Ubuntu 16.04 LTS - https://www.phusionpassenger.com/library/install/nginx/install/oss/xenial/
- Deploying a Ruby app on a Linux/Unix production server - https://www.phusionpassenger.com/library/walkthroughs/deploy/ruby/ownserver/nginx/oss/xenial/deploy_app.html
- Deploying application updates - https://www.phusionpassenger.com/library/walkthroughs/deploy/ruby/ownserver/nginx/oss/deploy_updates.html
~~~
git pull
bundle install --deployment --without development test
DISABLE_DATABASE_ENVIRONMENT_CHECK=1 rails db:drop RAILS_ENV=production
rails db:migrate RAILS_ENV=production
rails db:seed RAILS_ENV=production
~~~

## Testing
```bash
# GET    /articles
$curl 0.0.0.0:3000

# POST   /articles
$curl -d '{"title":"test1", "content":"lorem"}' -H "Content-Type: application/json" -X POST http://0.0.0.0:3000/articles

# GET    /articles/:id
$curl 0.0.0.0:3000/articles/1

# PATCH  /articles/:id
$curl -d '{"title":"test5", "content":"lorem5"}' -H "Content-Type: application/json" -X PATCH http://0.0.0.0:3000/articles/5


# PUT    /articles/:id

# DELETE /articles/:id

# https://rubyplus.com/articles/4921-Rails-Forgery-Protection-Basics
# 
curl http://localhost:3000/users/new --cookie-jar "cookie.txt"

# after this command, you will see a authenticity_token, please remember it.

curl http://localhost:3000/users --request POST --cookie-jar "cookie.txt" --cookie "cookie.txt" --data-urlencode "authenticity_token=cOusCzjDwAt6ybUCAICCw9W4Fq9jwOr8Tys7qn8+Sa6F/Pj/d8WzgisX7U6xEUrSUqQSBvi1WpK4GdXUdMoPOA==" --data "user[name]=Foo" --data "user[email]=foobar@gmail.com" --data "user[username]=foobar" --data "user[phone]=123" 
```



## References
- Mutual friendship in Rails - https://dankim.io/mutual-friendship-rails/
- Friendship fix - https://stackoverflow.com/questions/50614670/activerecordstatementinvalid-sqlite3sqlexception-no-such-table
- Self-Referential Association - http://railscasts.com/episodes/163-self-referential-association
- Faker::Avatar - https://github.com/stympy/faker/blob/master/doc/avatar.md
- Pluck vs select. Pluck takes lesser time but select returns the actual object - http://gavinmiller.io/2013/getting-to-know-pluck-and-select/
- Counter Cache - https://rubyplus.com/articles/3221-Counter-Cache-Column-in-Rails-5